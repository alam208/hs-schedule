<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TEST V3 ‚Äî JSON Loader</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f8fafc;color:#0f172a}
  .wrap{max-width:900px;margin:0 auto;padding:16px}
  header{border-bottom:1px solid #e2e8f0;background:#fff}
  input,button{padding:8px 10px;border:1px solid #cbd5e1;border-radius:8px}
  button{cursor:pointer}
  .row{display:flex;gap:8px;align-items:center}
  ul{padding-left:18px}
  li{margin:6px 0}
  .muted{color:#64748b}
</style>

<header class="wrap">
  <h1>TEST V3 ‚Äî JSON Loader (no badges)</h1>
</header>

<main class="wrap">
  <div class="row" style="margin:10px 0">
    <label>Tanggal (YYYY-MM-DD):
      <input id="date" type="date" />
    </label>
    <button id="loadBtn">Load JSON</button>
  </div>

  <div id="status" class="muted"></div>
  <div id="meta" class="muted" style="margin-top:6px"></div>
  <h3 id="count"></h3>
  <ul id="list"></ul>

  <p class="muted">Sumber: <a id="jsonLink" href="#" target="_blank" rel="noopener"></a></p>
</main>

<script>
  const GH_USER = "alam208";
  const REPO = "hs-schedule";
  const PAGES_BASE = `https://${GH_USER}.github.io/${REPO}`;

  const dateInput = document.getElementById('date');
  const btn = document.getElementById('loadBtn');
  const statusEl = document.getElementById('status');
  const metaEl = document.getElementById('meta');
  const countEl = document.getElementById('count');
  const listEl = document.getElementById('list');
  const jsonLink = document.getElementById('jsonLink');

  // default: hari ini
  const today = new Date();
  const pad = n => String(n).padStart(2,'0');
  dateInput.value = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;

  function urlFor(dStr){
    // dStr: 'YYYY-MM-DD'
    return `${PAGES_BASE}/data/hsfb-${dStr}.json`;
  }

  function isPlaceholder(name){
    const v = (name||"").trim().toLowerCase();
    return v === "" || v === "team a" || v === "team b" || v === "team";
  }

  async function load(){
    const d = dateInput.value;
    if(!d){ alert("Pilih tanggal dulu"); return; }
    const url = urlFor(d);
    jsonLink.textContent = url; jsonLink.href = url;

    statusEl.textContent = "Loading‚Ä¶";
    metaEl.textContent = "";
    countEl.textContent = "";
    listEl.innerHTML = "";

    try{
      const res = await fetch(url, {cache: 'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      // filter: buang entri placeholder / kosong
      const clean = (Array.isArray(data)? data:[]).filter(ev=>{
        if (isPlaceholder(ev.teamA) || isPlaceholder(ev.teamB)) return false;
        const useful = (ev.kick && ev.kick.trim()!=="") ||
                       (ev.venue && ev.venue.trim()!=="") ||
                       (ev.city && ev.city.trim()!=="") ||
                       (ev.state && ev.state.trim()!=="") ||
                       (ev.description && ev.description.trim()!=="");
        return !!useful;
      });

      statusEl.textContent = "";
      metaEl.textContent = `Menampilkan entri non-kosong.`;
      countEl.textContent = `Total games: ${clean.length}`;

      listEl.innerHTML = clean.slice(0,50).map(ev=>{
        const teamA = ev.mascotA ? `${ev.teamA} (${ev.mascotA})` : ev.teamA;
        const teamB = ev.mascotB ? `${ev.teamB} (${ev.mascotB})` : ev.teamB;
        const loc = ev.venue?.trim() || [ev.city, ev.state].filter(Boolean).join(', ') || ev.state || '‚Äî';
        const when = ev.kick?.trim() || 'TBA';
        return `<li><strong>${teamA}</strong> vs <strong>${teamB}</strong> ‚Ä¢ üïí ${when} ‚Ä¢ üìç ${loc}</li>`;
      }).join('');

      if (clean.length === 0){
        listEl.innerHTML = `<li class="muted">Tidak ada entri valid untuk tanggal ini. Cek apakah JSON ada dan berisi.</li>`;
      }
    }catch(err){
      statusEl.textContent = "Gagal load JSON. Pastikan file untuk tanggal itu ada.";
      console.error(err);
    }
  }

  btn.onclick = load;
</script>
</html>
